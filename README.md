# Решение тестового задания

## Настройка

### Режим исполнения

Режим исполнения устанавливается в переменной `UPDATE_TYPE`:

```
private const UpdateType UPDATE_TYPE = UpdateType.OnlyByLastTwoDay;
```

Данная программа имеет 2 режима исолнения:

```
enum UpdateType
{
    All,
    OnlyByLastTwoDay
}
```

1. All - выполняет полную загрузку данных при запуске и с каждой последующей итерацией. Необходимо применять, если данные о сделках могут быть добавлены задним числом;
2. OnlyByLastTwoDay - выполняет полную загрузку данных, но при каждой последующей итерции загружает только данные за последние 2 дня. Необходимо применять, если данные о сделках добавляются последовательно.

### Интервал

Интервал между запросами устанавливается в переменной `DELAY`:

```
private readonly static TimeSpan DELAY = TimeSpan.FromMinutes(10);
```

### Размер выборки

Размер выборки определяет количество запрашиваемых сделок и устанавливается в переменной `DEALS_PER_PAGE`:

```
private const int DEALS_PER_PAGE = 50_000;
```

## Структура базы данных

База данных содержит 2 таблицы `wood_deal` и `temp_wood_deal`. 

- `wood_deal` - содержит информацию о совершенных сделках;
- `temp_wood_deal` - копия таблицы `wood_deal`. Применяется для ускорения вставки большого объема даннъх.

### wood_deal

Key | Column Name | Data Type | Allow Null | Description
--- |  --- | --- | --- | ---
PK | number | nvarchar(29) | no | Уникальный идентификатор сделки
-- | sellerName | nvarchar(350) | yes | Наименование продавца
-- | sellerInn | nvarchar(14) | yes | ИНН продавца
-- | sellAmount | real | no | Размер продажи
-- | buyerName | nvarchar(350) | yes | Наименование покупателя
-- | buyerInn | nvarchar(30) | yes | ИНН покупателя
-- | buyAmount | real | no | Размер покупки
-- | dealDate | datetime2(7) | yes | Дата совершения сделки

Данная таблица находится не в нормальной форме. Для нармализации необходимо выделить информацию об участниках сделки `seller` и `buyer` в отдельную таблицу. Нормализация позволит уменьшить объем занимаемой памяти, но увеличит время сбора даннх.